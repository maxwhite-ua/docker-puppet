FROM puppet:latest
MAINTAINER Nick Jones "nick@dischord.org"

ENV FACTER_role='webserver'
ENV FACTER_container='dischord_webserver'
ENV FACTER_aptproxy='192.168.2.115'

RUN puppet apply --verbose --debug \
		--modulepath /puppet/modules \
		--hiera_config /puppet/hiera.yaml \
		--manifestdir /puppet/ /puppet/default.pp

RUN apt-get -y clean && rm -rf /puppet

EXPOSE 80 443

CMD ["/usr/bin/supervisord", "-n"]
